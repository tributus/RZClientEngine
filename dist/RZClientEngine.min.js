function StringBuilder(){var strings=[];this.append=function(string){string=verify(string),string.length>0&&(strings[strings.length]=string)},this.appendLine=function(string){if(string=verify(string),this.isEmpty()){if(!(string.length>0))return;strings[strings.length]=string}else strings[strings.length]=string.length>0?"\r\n"+string:"\r\n"},this.appendFormat=function(string){string=verify(string);for(var fstring=string,i=1;i<arguments.length;i++)pattern=new RegExp("\\{"+(i-1).toString()+"}","g"),fstring=fstring.replace(pattern,arguments[i]);string.length>0&&(strings[strings.length]=fstring)},this.appendLineFormat=function(string){string=verify(string);for(var fstring=string,i=1;i<arguments.length;i++)pattern=new RegExp("\\{"+(i-1).toString()+"}","g"),fstring=fstring.replace(pattern,arguments[i]);if(this.isEmpty()){if(!(fstring.length>0))return;strings[fstring.length]=fstring}else strings[strings.length]=string.length>0?"\r\n"+fstring:"\r\n"},this.clear=function(){strings=[]},this.isEmpty=function(){return 0==strings.length},this.toString=function(){return strings.join("")};var verify=function(string){return defined(string)?getType(string)!=getType(new String)?String(string):string:""},defined=function(el){return null!=el&&"undefined"!=typeof el},getType=function(instance){if(!defined(instance.constructor))throw Error("Unexpected object type");var type=String(instance.constructor).match(/function\s+(\w+)/);return defined(type)?type[1]:"undefined"}}function generateRandomID(size){for(var s=void 0===size?8:size,possible="abcdefghijklmnopqrstuvwxyz0123456789_",id="wdgv_",i=0;s>i;i++)id+=possible.charAt(Math.floor(Math.random()*possible.length));return id}Array.prototype.find||(Array.prototype.find=function(predicate){if(null===this)throw new TypeError("Array.prototype.find called on null or undefined");if("function"!=typeof predicate)throw new TypeError("predicate must be a function");for(var value,list=Object(this),length=list.length>>>0,thisArg=arguments[1],i=0;length>i;i++)if(value=list[i],predicate.call(thisArg,value,i,list))return value}),Array.prototype.findIndex||(Array.prototype.findIndex=function(predicate){if(null===this)throw new TypeError("Array.prototype.findIndex called on null or undefined");if("function"!=typeof predicate)throw new TypeError("predicate must be a function");for(var value,list=Object(this),length=list.length>>>0,thisArg=arguments[1],i=0;length>i;i++)if(value=list[i],predicate.call(thisArg,value,i,list))return i;return-1}),String.prototype.startsWith=function(str){return 0==this.indexOf(str)};var rz=rz||{},$RZ_APP=$RZ_APP||{};rz.engine={},rz.widgets={},rz.plugins={},rz.utils={},rz.helpers={},rz.behaviors={},rz.instrumentation={},rz.httpclient={},rz.settings={},$RZ_APP.ui={},rz.helpers.StringBuilder=StringBuilder,rz.helpers.generateRandomID=generateRandomID,rz.helpers.ensureFunction=function(f){return void 0===f?function(){}:f},rz.helpers.jsonUtils={getDataAtPath:function(obj,path){if(void 0!==obj&&null!=obj){var propArray=this.extractPropertyTree(path),pos=0,lastRef=obj,val=void 0,getPropertyType=function(propString){return propString.match(/^([a-zA-Z_$ºª]+([0-9]+)?)+(\[[0-9]+])$/)?"ua":propString.match(/^([a-zA-Z_$ºª]+([0-9]+)?)+(\[])$/)?"dua":propString.match(/^([a-zA-Z_$ºª]+([0-9]+)?)+(\[[0-9]+])+$/)?"ma":"sp"},isLast=function(){return pos==propArray.length-1},transverse=function(item){var propType=getPropertyType(item),last=isLast();if("sp"==propType)last?val=lastRef[item]:(lastRef=lastRef[item],void 0===lastRef?val=void 0:transverse(propArray[++pos]));else if("ua"==propType){var parts=item.replace(/\[/,".").replace("]","").split("."),name=parts[0],position=parts[1];last?val=void 0!==lastRef[name]?lastRef[name][position]:void 0:void 0===lastRef||void 0===lastRef[name]||void 0===lastRef[name][position]?val=void 0:(lastRef=lastRef[name][position],transverse(propArray[++pos]))}else if("dua"==propType){var name=item.replace("[]",""),position=void 0===lastRef||void 0===lastRef[name]?0:lastRef[name].length-1;last?val=void 0!==lastRef[name]?lastRef[name][position]:void 0:void 0!==lastRef[name]&&void 0!=lastRef[name][position]?(lastRef=lastRef[name][position],transverse(propArray[++pos])):val=void 0}else if("ma"==propType)throw"not implemented yet"};return transverse(propArray[pos]),val}},setDataAtPath:function(obj,value,path){(void 0===obj||null==obj)&&(obj={});var propArray=this.extractPropertyTree(path),pos=0,lastRef=obj,getPropertyType=function(propString){return propString.match(/^([a-zA-Z_$ºª]+([0-9]+)?)+(\[[0-9]+])$/)?"ua":propString.match(/^([a-zA-Z_$ºª]+([0-9]+)?)+(\[])$/)?"dua":propString.match(/^([a-zA-Z_$ºª]+([0-9]+)?)+(\[[0-9]+])+$/)?"ma":"sp"},isLast=function(){return pos==propArray.length-1},ensureProperty=function(item,propType){if("sp"==propType)return void 0===lastRef[item]&&(lastRef[item]={}),lastRef[item];if("ua"==propType){var parts=item.replace(/\[/,".").replace("]","").split("."),name=parts[0],position=parts[1];return void 0==lastRef[name]&&(lastRef[name]=[]),void 0==lastRef[name][position]&&(lastRef[name][position]={}),lastRef[name][position]}if("dua"==propType){var name=item.replace("[]",""),position=0;return void 0==lastRef[name]?lastRef[name]=[]:position=lastRef[name].length,void 0==lastRef[name][position]&&(lastRef[name][position]={}),lastRef[name][position]}if("ma"==propType){throw"not implemented yet. This component version not suports multi-dimensional arrays";var parts,name,cont,evalExpr}},transverse=function(item){var propType=getPropertyType(item);if(isLast()){if(ensureProperty(item,propType),"sp"==propType)lastRef[item]=value;else if("ua"==propType){var parts=item.replace(/\[/,".").replace("]","").split("."),name=parts[0],position=parts[1];lastRef[name][position]=value}else if("dua"==propType){var name=item.replace("[]",""),position=lastRef[name].length-1;lastRef[name][position]=value}else if("ma"==propType){var parts=item.replace("["," [").split(" ");eval("lastRef['"+parts[0]+"']"+parts[1]+" = value")}}else lastRef=ensureProperty(item,propType),transverse(propArray[++pos])};transverse(propArray[pos])},extractPropertyTree:function(expression){var START_CHAR_PATTERN=/^[a-zA-Z_$ºª]$/,OPEN_ARRAY_PATTERN=/^\[$/,CLOSE_ARRAY_PATTERN=/^]$/,CHAR_OR_DIGIT_PATTERN=/^[a-zA-Z_$ºª]|[0-9]$/,DOT_PATTERN=/^\.$/,ONLY_DIGIT_PATTERN=/^[0-9]$/,DOUBLE_QUOTE_PATTERN=/^"$/,SINGLE_QUOTE_PATTERN=/^'$/,ANY_PATTERN=/^.$/,properties=[],currentProperty="",normalize=function(){for(var i=0;i<properties.length;i++)properties[i]=properties[i].replace(/(\["|\[')|("]|'])/g,"")},dfa=new rz.plugins.DFAMachine(function(node,currentChar){switch(node){case"C":properties.push(currentProperty),currentProperty="";break;case"D":currentProperty+=currentChar;break;case"G":case"K":""!==currentProperty&&""!==currentProperty.substr(0,currentProperty.length-1)?(properties.push(currentProperty.substr(0,currentProperty.length-1)),currentProperty="["+currentChar):currentProperty+=currentChar;break;case"END":""!==currentProperty&&properties.push(currentProperty);break;default:currentProperty+=currentChar}});return dfa.addNode("START",[{pattern:START_CHAR_PATTERN,node:"A"},{pattern:OPEN_ARRAY_PATTERN,node:"J"}]),dfa.addNode("A",[{pattern:CHAR_OR_DIGIT_PATTERN,node:"A"},{pattern:OPEN_ARRAY_PATTERN,node:"D"},{pattern:DOT_PATTERN,node:"C"},{node:"END"}]),dfa.addNode("C",[{pattern:START_CHAR_PATTERN,node:"A"}]),dfa.addNode("D",[{pattern:ONLY_DIGIT_PATTERN,node:"E"},{pattern:CLOSE_ARRAY_PATTERN,node:"F"},{pattern:DOUBLE_QUOTE_PATTERN,node:"G"},{pattern:SINGLE_QUOTE_PATTERN,node:"K"}]),dfa.addNode("E",[{pattern:ONLY_DIGIT_PATTERN,node:"E"},{pattern:CLOSE_ARRAY_PATTERN,node:"F"}]),dfa.addNode("F",[{pattern:DOT_PATTERN,node:"C"},{pattern:OPEN_ARRAY_PATTERN,node:"D"},{node:"END"}]),dfa.addNode("G",[{pattern:DOUBLE_QUOTE_PATTERN,node:"ERROR"},{pattern:ANY_PATTERN,node:"H"}]),dfa.addNode("H",[{pattern:DOUBLE_QUOTE_PATTERN,node:"I"},{pattern:ANY_PATTERN,node:"H"}]),dfa.addNode("I",[{pattern:CLOSE_ARRAY_PATTERN,node:"F"}]),dfa.addNode("J",[{pattern:DOUBLE_QUOTE_PATTERN,node:"G"},{pattern:SINGLE_QUOTE_PATTERN,node:"K"}]),dfa.addNode("K",[{pattern:SINGLE_QUOTE_PATTERN,node:"ERROR"},{pattern:ANY_PATTERN,node:"L"}]),dfa.addNode("L",[{pattern:SINGLE_QUOTE_PATTERN,node:"M"},{pattern:ANY_PATTERN,node:"L"}]),dfa.addNode("M",[{pattern:CLOSE_ARRAY_PATTERN,node:"F"}]),dfa.addNode("END"),dfa.start(expression),normalize(),properties},isValidPropertyExpression:function(expression,callback){try{var propertytree=this.extractPropertyTree(expression);return callback&&callback(!0,propertytree),!0}catch(ex){return callback&&callback(!1),!1}}},rz.instrumentation.platformInfo={getPlatformVersion:function(){return"0.6.0-ALPHA"}},rz.instrumentation.log={logListeners:[],registerListener:function(l){this.logListeners.push(l)},broadCast:function(message,data,type){var $this=this;setTimeout(function(){$this.logListeners.forEach(function(l){l({message:message,type:type,data:data})})},10)},debug:function(message,data){this.broadCast(message,data,"debug")},info:function(message,data){this.broadCast(message,data,"info")},warn:function(message,data){this.broadCast(message,data,"warning")},error:function(message,data){this.broadCast(message,data,"error")}};var ruteZangada=function($){var $this=this;return this.extend=function(n,f){$this[n]=f},this.get=function(url,callback){callback=callback||function(){},$.get(url,function(data,status,jqxhr){callback(data,status,jqxhr)}).fail(function(data,status){callback(data,status)})},this.post=function(url,data,callback){throw alert("NOT IMPLEMENTED"),"NOT_IMPLEMENTED"},this.put=function(url,data,callback){throw alert("NOT IMPLEMENTED"),"NOT_IMPLEMENTED"},this["delete"]=function(url,data,callback){throw alert("NOT IMPLEMENTED"),"NOT_IMPLEMENTED"},this}(jQuery),$rzs={s1:"invalid widget format",s2:"NOT_A_FUNCTION",s3:"NO_INITIALIZE_FUNCTION",s4:"NO_RENDER_FUNCTION",s5:"error registering widget",s6:"widget definition not found",s7:"UNKNOWN_WIDGET_DEFINITION",s8:"http://support.rz.com/rzframework/doc/common_errors"};rz.widgets.helpers={widgets:{},widgetsMetaData:{},validateWidgetStructure:function(d){if("function"!=typeof d)throw this.error(1,$rzs.s1,$rzs.s2)},error:function(code,msg,d){return{code:code,message:msg,details:d,helpLink:$rzs.s8+"?code="+code+"&d="+d}},setupWidgetEventHandlers:function(eventData,h){eventData.definition.eventHandlers={},eventData.definition.eventHandlerDescriptions={},void 0!==h&&h.length>0&&h.forEach(function(it){if("string"==typeof it)eventData.definition.eventHandlers[it]=[],eventData.definition.eventHandlerDescriptions[it]={},rz.widgets.helpers.widgetsMetaData[eventData.name].eventInfo[it]={};else{if("object"!=typeof it)throw"invalid event handler definition";eventData.definition.eventHandlers[it.name]=[],eventData.definition.eventHandlerDescriptions[it.name]=it,rz.widgets.helpers.widgetsMetaData[eventData.name].eventInfo[it.name]=it}}),eventData.definition.prototype.on=function(eventName,handler){void 0===eventData.definition.eventHandlers[eventName]&&(eventData.definition.eventHandlers[eventName]=[],rz.instrumentation.log.warn("unknown eventhandler registered",{eventName:eventName,handler:handler}));try{eventData.definition.eventHandlers[eventName].push(handler)}catch(e){rz.instrumentation.log.error("invalid event handler ",{eventName:eventName,handler:handler})}},eventData.definition.prototype.raiseEvent=function(name,args,sender){var handlers=sender.getEventHandler(name);void 0!==handlers&&handlers.length>0&&handlers.forEach(function(it){it(sender,args)})},eventData.definition.prototype.getEventHandlers=function(){return eventData.definition.eventHandlers},eventData.definition.prototype.getEventHandler=function(name){return eventData.definition.eventHandlers[name]},eventData.definition.prototype.getEventHandlersDescriptions=function(){return eventData.definition.eventHandlerDescriptions},eventData.definition.prototype.getEventHandlersDescription=function(name){return eventData.definition.eventHandlerDescriptions[name]}},setupMethodHandler:function(eventData,methodHandlers){var defaultMHandler=function(){throw"not implemented"};eventData.definition.methodDescriptions={},void 0!==methodHandlers&&methodHandlers.length>0&&methodHandlers.forEach(function(it){if("string"==typeof it)eventData.definition.methodDescriptions[it]={},eventData.definition.prototype[it]=defaultMHandler,rz.widgets.helpers.widgetsMetaData[eventData.name].methodInfo[it]={};else{if("object"!=typeof it||void 0===it.name)throw"incorrect data format";eventData.definition.methodDescriptions[it.name]=it,eventData.definition.prototype[it.name]=defaultMHandler,rz.widgets.helpers.widgetsMetaData[eventData.name].methodInfo[it.name]=it}}),eventData.definition.prototype.getMethodDescriptors=function(){return eventData.definition.methodDescriptions},eventData.definition.prototype.getMethodDescriptor=function(methodName){return eventData.definition.methodDescriptions[methodName]}}},rz.widgets.extensions={registeredExtensions:{},extension:function(name,type,definition){this.registeredExtensions[type]=this.registeredExtensions[type]||{},this.registeredExtensions[type][name]=definition},getExtension:function(name,type){return(this.registeredExtensions[type]||{})[name]},getExtensionsByType:function(type){return this.registeredExtensions[type]}},rz.engine.widgetDefinitionMethod=function(n,m,h,d){try{var eventData={name:n,definition:d,methodDeclarations:m,eventHandlers:h,cancel:!1};if(!eventData.cancel)return rz.widgets.helpers.validateWidgetStructure(eventData.definition),rz.widgets.helpers.widgetsMetaData[eventData.name]={},rz.widgets.helpers.widgetsMetaData[eventData.name].methodInfo={},rz.widgets.helpers.widgetsMetaData[eventData.name].eventInfo={},rz.widgets.helpers.setupWidgetEventHandlers(eventData,h),rz.widgets.helpers.setupMethodHandler(eventData,m),rz.widgets.helpers.widgets[eventData.name]=eventData.definition,eventData.definition}catch(err){throw console.error("%O",err),$rzs.s5}},rz.engine.renderWidgetDefinitionMethod=function(w,t,d,p){var Widget=rz.widgets.helpers.widgets[w];if(void 0===Widget)throw rz.widgets.helpers.error(2,$rzs.s7,$rzs.s6);var widget=new Widget;return widget.initialize(d,function(pd){var ref={renderData:widget.render(t,pd,function(renderData){if(void 0!==p){var eventArgs={cancel:!1,params:pd,rd:renderData};p(renderData,eventArgs,function(p){p.cancel||ruteZangada.plot(p.rd)})}else ruteZangada.plot(renderData)})};return ref}),widget},rz.engine.plotContentMethod=function(data){"append"==data.method?$(data.target).append(data.data.toString()):$(data.target).html(data.data.toString()),void 0!==data.doAfterRenderAction&&data.doAfterRenderAction(),void 0!==data.sender&&data.sender.raiseEvent("widget-rendered",void 0,data.sender)},rz.engine.getWidgetEventHandlersDescriptionsMethod=function(widgetName){return rz.widgets.helpers.widgetsMetaData[widgetName].eventInfo},rz.engine.getWidgetEventHandlersDescriptionMethod=function(widgetName,eventName){return rz.widgets.helpers.widgetsMetaData[widgetName].eventInfo[eventName]},rz.engine.getWidgetMethodsDescriptionsMethod=function(widgetName){return rz.widgets.helpers.widgetsMetaData[widgetName].methodInfo},rz.engine.getWidgetMethodsDescriptionMethod=function(widgetName,methodName){return rz.widgets.helpers.widgetsMetaData[widgetName].methodInfo[methodName]},ruteZangada.extend("widget",rz.engine.widgetDefinitionMethod),ruteZangada.extend("renderWidget",rz.engine.renderWidgetDefinitionMethod),ruteZangada.extend("getWidgetEventHandlersDescriptions",rz.engine.getWidgetEventHandlersDescriptionsMethod),ruteZangada.extend("getWidgetEventHandlersDescription",rz.engine.getWidgetEventHandlersDescriptionMethod),ruteZangada.extend("getWidgetMethodsDescriptions",rz.engine.getWidgetMethodsDescriptionsMethod),ruteZangada.extend("getWidgetMethodsDescription",rz.engine.getWidgetMethodsDescriptionMethod),ruteZangada.extend("plot",rz.engine.plotContentMethod),rz.behaviors.helpers={behaviors:{},behaviorsMetadata:{}},rz.engine.behaviorDefinitionMethod=function(n,m,d){var validateBehaviorStructure=function(){return!0},applyDefaulStructure=function(){d.prototype.initialize=function(){throw"initialize method is not implemented"}};return validateBehaviorStructure(d)?(rz.behaviors.helpers.behaviorsMetadata[n]=m,applyDefaulStructure(),rz.behaviors.helpers.behaviors[n]=d,d):void 0},rz.engine.loadBehaviorMethod=function(name,params){var behavior=rz.behaviors.helpers.behaviors[name];if(void 0!==behavior){var bh=new behavior(params);return bh.initialize(),bh}throw"behavior not registered"},ruteZangada.extend("behavior",rz.engine.behaviorDefinitionMethod),ruteZangada.extend("loadBehavior",rz.engine.loadBehaviorMethod),rz.utils.uri={getSearch:function(url){var fploc_i=url.indexOf("?"),fploc_h=url.indexOf("#"),fploc_d=url.indexOf("&"),foundValues=[];if(fploc_i>=0&&foundValues.push(fploc_i),fploc_h>=0&&foundValues.push(fploc_h),fploc_d>=0&&foundValues.push(fploc_d),0==foundValues.length)return"";var min=foundValues.reduce(function(a,b){return Math.min(a,b)});return url.substring(min)},getParamCount:function(url){var query=this.getSearch(url);return(query.match(new RegExp(/[\?|&|#][a-zA-Z0-9+]+(=([^&|#|?*]*))?/g))||[]).length},getParamList:function(url){var query=this.getSearch(url),rawParams=query.match(new RegExp(/([\?|&|#][a-zA-Z0-9+]+=?)/g))||[],oparams=[];return rawParams.forEach(function(it){oparams.push(it.replace(/[?|&|=|#]/g,""))}),oparams},hasParam:function(url,p){var query=this.getSearch(url);return void 0!==(query.match(new RegExp("[?&#]"+p+"=([^&]+)"))||[])[0]},getParamValue:function(url,p){if(this.hasParam(url,p)){var query=this.getSearch(url);return((query.match(new RegExp("[?&#]"+p+"=([^&|^?|^#]+)"))||[])[0]||"").replace(/[?|&|#][a-zA-Z0-9*]+=/g,"")}},mergeParam:function(url,p,v){var paramWithValue=p+"="+v;return this.getParamList(url).length>0?url+"&"+paramWithValue:url+"?"+paramWithValue}},rz.plugins.jsonFilterEngine=function(opt){var getConnector=function(condition){if(void 0===condition.connector)return"&&";switch(condition.connector.toLocaleLowerCase()){case"and":return" && ";case"or":return" || ";case"and not":return" && !";case"or not":return" || !";default:return" && "}},getOperator=function(condition){if(void 0==condition.operator)return"===";switch(condition.operator.toLowerCase()){case"equals":case"=":case"==":case"===":return"===@";case"notequas":case"<>":case"!=":case"!==":return"!==@";case"gt":case">":case"greaterthan":return" > @";case"lt":case"<":case"lessthan":return" < @";case"gte":case">=":case"greaterthanorequal":return" >= @";case"lte":case"<=":case"lessthanorequal":return" >= @";case"startswith":case"::=":return".startsWith(@)";case"endswith":case"=::":return".endsWith(@)";case"contains":case":=:":return".indexOf(@)!=-1";default:return condition.operator}};this.json2filterFunction=function(filterExpression){var filterString="",processNodes=function(nodelist){var blockStart=!0;nodelist.forEach(function(item){blockStart?blockStart=!1:filterString+=getConnector(item),void 0===item.conditions?filterString+="m."+item.field+getOperator(item).replace("@",item.value):(filterString+="(",processNodes(item.conditions),filterString+=")")})};return processNodes(filterExpression),filterString},this.buildFilterFunction=function(filterExpression){var expressionString=this.json2filterFunction(filterExpression),r=function(m){return eval(expressionString)};return r}},rz.plugins.DFAMachine=function(onNodeEnter){var $this=this,expression="",nodes={},currentChar=0;this.resultHandler=void 0;var char="";this.onNodeEnter=onNodeEnter;var ERROR=function(){var msg="parseError at position "+currentChar.toString()+"\n"+expression+"\n"+" ".repeat(currentChar-1)+"^";if(void 0===$this.resultHandler)throw msg;$this.resultHandler({status:"fail",message:msg})},getNextChar=function(){var char=pickNextChar();return currentChar+=1,char},pickNextChar=function(){if(currentChar!=expression.length){var char=expression.substr(currentChar,1);return""!==char&&void 0!=char?char:void 0}},raiseOnNodeEnther=function(node,currentChar,nextChar){void 0!=$this.onNodeEnter&&$this.onNodeEnter(node,currentChar,nextChar,expression)},processNode=function(node){if(raiseOnNodeEnther(node,char,pickNextChar()),"END"!==node){char=getNextChar();var rules=nodes[node],ERR=!0;void 0!=rules&&rules.length>0?rules.every(function(item){return void 0===char?void 0==item.pattern?(ERR=!1,void 0!==item.node&&("ERROR"==item.node?(ERR=!0,ERROR()):processNode(item.node)),!1):!0:null!=char.match(item.pattern)?(ERR=!1,void 0!==item.node&&("ERROR"==item.node?(ERR=!0,ERROR()):processNode(item.node)),!1):!0}):ERR=!1,ERR&&ERROR()}};this.addNode=function(nodeName,rules){nodes[nodeName]=rules},this.start=function(inputValue,rhandler,startNode){void 0!==rhandler&&($this.resultHandler=rhandler),expression=inputValue,currentChar=0,startNode=startNode||"START",processNode(startNode),void 0!==getNextChar()?ERROR():void 0!==$this.resultHandler&&$this.resultHandler({status:"success",message:'success parsing expression "'+expression+'"'})}},rz.plugins.Pipeline=function(){var tasks={},context={},workflows={},executionLog=[],eventHandlers={"task-started":[],"task-finished":[],"workflow-started":[],"workflow-finished":[],"workflow-stoped":[]},signals={},$this=this,executeTask=function(workFlow,step,previousStep){var transition=workFlow[step];if(rz.instrumentation.log.debug("Executing transition: "+transition),!transition||"string"!=typeof transition)throw"NOT IMPLEMENTED";var task=tasks[transition];if(!task)throw'Task "*" not found'.replace("*",transition);raiseEvent("task-started",{context:context,workflow:workFlow,step:step,previousStep:previousStep}),task.handler($this,stepDone,task.options,signalHandler,previousStep)},registerTaskExecutionLog=function(data){executionLog.push(data)},stepDone=function(status,stepData){var workflow=workflows[context.runningWorkflowName],previousStep={taskName:workflow[context.currentStep],step:context.currentStep,status:status||0,stepData:stepData};registerTaskExecutionLog(previousStep),raiseEvent("task-finished",previousStep),255!=status?(context.currentStep++,context.currentStep<workflow.length&&setTimeout(function(){return executeTask(workflow,context.currentStep,previousStep)},1),context.currentStep!=workflow.length||context.isWorkflowFinished||(context.isWorkflowFinished=!0,finishWorkflowExecution())):(raiseEvent("workflow-stoped",{status:255,context:context}),finishWorkflowExecution())},finishWorkflowExecution=function(){raiseEvent("workflow-finished",{context:context})};this.task=function(taskName,handler,options){tasks[taskName]={handler:handler,options:options}},this.pipeline=function(workflowName,workflowHandler){workflows[workflowName]=workflowHandler},this.setVar=function(varName,value){context[varName]=value},this.getVar=function(varName){return context[varName]},this.getExecutionLog=function(){return executionLog},reset=function(){context.currentStep=0,executionLog=[],context.isWorkflowFinished=!1},this.start=function(workflowName){workflowName=workflowName||"default";var workflow=workflows[workflowName];if(!workflow)throw"workflow not found: "+workflowName;context.runningWorkflowName=workflowName,reset(),raiseEvent("workflow-started",{context:context}),executeTask(workflow,0)},this.on=function(eventName,eventHandler){eventHandlers[eventName]?eventHandlers[eventName].push(eventHandler):(signals[eventName]||(signals[eventName]=[]),signals[eventName].push(eventHandler))},this.detachEvent=function(eventName,eventHandler){if(eventHandlers[eventName]){var index=eventHandlers[eventName].indexOf(eventHandler);eventHandlers[eventName].splice(index,1)}};var raiseEvent=function(eventName,eventData){var handlerList=eventHandlers[eventName];handlerList&&handlerList.forEach(function(it){it($this,eventData)})},signalHandler=function(signalName,signalData,callback){if(eventHandlers[signalName])throw'invalid signal "'+signalName+'". Use another signal name';var handlerList=signals[signalName];handlerList&&handlerList.forEach(function(it){it($this,signalData,callback)})}},rz.httpclient.ajax=function(method,url,data,success,fail,sudouser,sudokey){$.ajax({type:method,url:url,data:JSON.stringify(data),crossDomain:!0,headers:{"sudo-user":sudouser||"","sudo-key":sudokey||""},success:function(d){void 0!==d&&"authentication"!==d.status?success&&success(d):setTimeout(function(){$RZ_APP.ui.sudo(d,method,url,data,success,fail)},1e3)},error:function(e){if(fail)fail(e);else{var message="Erro consultando o serviço";$RZ_APP.ui.alert(message),console.warn(message,e)}},dataType:"json",contentType:"application/json"})},rz.httpclient.get=function(url,data,success,fail){rz.httpclient.ajax("GET",url,data,success,fail)},rz.httpclient.post=function(url,data,success,fail){rz.httpclient.ajax("post",url,data,success,fail)},rz.httpclient.postX=function(url,data,success,fail){$.ajax({url:url,type:"post",data:data,crossDomain:!0,success:function(d){success&&success(d)},error:function(e){if(200==e.status){var resp=JSON.parse(e.responseText);success({status:"success",data:resp})}else if(401==e.status)success({status:"fail"});else{var mensagem="Erro efetuando o login";console.warn(mensagem,e),fail?fail(e):$RZ_APP.ui.alert(mensagem)}},dataType:"text/html"})},rz.httpclient.put=function(url,data,success,fail){rz.httpclient.ajax("put",url,data,success,fail)},rz.httpclient["delete"]=function(url,data,success,fail){rz.httpclient.ajax("delete",url,data,success,fail)},rz.httpclient.buildApiUrl=function(url,params,apiVersion){apiVersion=apiVersion||"1";var baseUrl=$RZ_APP.Settings.apiBaseUrl.replace("{version}",apiVersion);if(params){var keys=url.match(/\{[a-zA-Z]+}/g);keys&&keys.forEach(function(key){var paramVal=params[key.replace(/\{|}/g,"")]||"";url=url.replace(key,paramVal)})}return baseUrl+url},rz.httpclient.buildExternalApiUrl=function(url,params){if(params){var keys=url.match(/\{[a-zA-Z]+}/g);keys&&keys.forEach(function(key){var paramVal=params[key.replace(/\{|}/g,"")]||"";url=url.replace(key,paramVal)})}return url},rz.httpclient.buildUrl=function(url,params){if(params){var keys=url.match(/\{[a-zA-Z]+}/g);keys&&keys.forEach(function(key){url=url.replace(key,params[key.replace(/\{|}/g,"")])})}return url},rz.httpclient.setBaseApiUrl=function(value){$RZ_APP.Settings.apiBaseUrl=value},rz.apiEndpoints={},rz.httpclient.registerApiEndpoint=function(name,handler){rz.apiEndpoints[name]=handler},rz.httpclient.callApi=function(name,params,requestBody,success,fail){var apiData=rz.apiEndpoints[name];if(apiData){var url=apiData.external?rz.httpclient.buildExternalApiUrl(apiData.url,params):rz.httpclient.buildApiUrl(apiData.url,params),__call=function(f_url,f_requestBody,f_apiData){rz.httpclient[(f_apiData.method||"get").toLowerCase()](f_url,f_requestBody,success,fail)};apiData.beforeCall?apiData.beforeCall(apiData,url,params,requestBody,function(i_apiData,i_url,i_requestBody,cancel){cancel?success({status:"canceled"}):__call(i_url,i_requestBody,i_apiData)}):__call(url,requestBody,apiData)}else fail({error:"api endpoint not registered"})},rz.httpclient.registerApiEndpoint("get context info",{url:"auth/session",method:"GET",external:!1,beforeCall:function(apiData,url,params,requestBody,callback){var cancel=!1;return callback(apiData,url,requestBody,cancel)}}),rz.httpclient.registerApiEndpoint("api test",{url:"testes/t1/{data}",method:"GET",external:!1}),$RZ_APP.ui.success=function(){console.warn("NOT IMPLEMENTED YET. THIS METHOD MUST BE OVERRIDEN")},$RZ_APP.ui.info=function(){console.warn("NOT IMPLEMENTED YET. THIS METHOD MUST BE OVERRIDEN")},$RZ_APP.ui.error=function(){console.warn("NOT IMPLEMENTED YET. THIS METHOD MUST BE OVERRIDEN")},$RZ_APP.ui.alert=function(){console.warn("NOT IMPLEMENTED YET. THIS METHOD MUST BE OVERRIDEN")},$RZ_APP.ui.sudo=function(){console.warn("NOT IMPLEMENTED YET. THIS METHOD MUST BE OVERRIDEN")},$RZ_APP.ui.modal=function(){console.warn("NOT IMPLEMENTED YET. THIS METHOD MUST BE OVERRIDEN")},$RZ_APP.ui.notify=function(){console.warn("NOT IMPLEMENTED YET. THIS METHOD MUST BE OVERRIDEN")};